***** JOYSTICK / PIA OUTPUT

	ORG $A800

* CONSTANTS

* PIA SETUP
PORTA	EQU $D300
PCTL	EQU $D302
PORT	EQU PORTA
MODEOUT	EQU $FF
* FUNCTION KEY
CONSOL	EQU $D01F
CSTART	EQU $01
* JOYSTICK PORT PINS
UP1	EQU $01	;PORT 1
DOWN1	EQU $02
LEFT1	EQU $04
RIGHT1	EQU $08
UP2	EQU $10	;PORT 2
DOWN2	EQU $20
LEFT2	EQU $40
RIGHT2	EQU $80
OFF	EQU 0

* ACTUAL PIA OUTPUT

START	LDA #$38
	STA PCTL
	LDA #MODEOUT
	STA PORT
	LDA #$3C
	STA PCTL
	LDA #RIGHT1
	STA PORT

* WAIT FOR START KEY

	PRINT 0,TMSG
WAIT	PRINT 0,TDOT
XWAIT	LDA #CSTART
	BIT CONSOL
	BEQ CLEANUP
	JSR DELAY
	JMP WAIT

* RESET PIA PORT

CLEANUP	LDA #OFF
	STA PORT

* THIS IS THE END MY FRIEND

THEEND	LDA #$FF
	BRK

***** UTILITIES *****

* DELAY LOOP
DELAY	LDX #$FF
LP1	LDY #$FF
LP2	DEY
	BNE LP2
	DEX
	BNE LP1
	RTS

***********************************
* PARTS OF IOLIB FROM PETER FINZEL
***********************************

* IOCB-Konstante

CIOV	EQU $E456
ICCOM	EQU $342
ICSTA	EQU $343
ICBAL	EQU $344
ICBAH	EQU $345
ICBLL	EQU $348
ICBLH	EQU $349
ICAX1	EQU $34A
ICAX2	EQU $34B

* CIO-Befehle

COPEN	EQU   3
CCLSE	EQU  12
CGTXT	EQU   5
CPTXT	EQU   9
CGBIN	EQU   7
CPBIN	EQU  11
EOL	EQU $9B

KANNUM	MACRO KANAL
	LDA #KANAL	;IOCB-Offset
	ASL		;aus Kanalnr.
	ASL		;(mal 16)
	ASL
	ASL
	TAX	;ERGEBNIS IM X-REG
	MEND

PRINT	MACRO KANAL,LABEL
	KANNUM KANAL
	LDA #CPTXT
	STA ICCOM,X
	LDA #LABEL
	STA ICBAL,X
	LDA #LABEL/256
	STA ICBAH,X
	LDA #127
	STA ICBLL,X
	LDA #0
	STA ICBLH,X
	JSR CIOV
	MEND

* TEXT OUTSIDE PROGRAM (WHY?)

TMSG	ASC "PRESS START TO END"
TDOT	ASC "."
	DFB EOL
